# Документация

## Схема API
Open API схема доступна [здесь](api-schema.yaml)

## Схема базы данных
<img src="https://user-images.githubusercontent.com/36979003/222919825-a5fe799c-85af-4788-bd07-661806db6fdb.png" width="800" />

## Компоненты системы

### Описание структуры пакетов
Основные пакеты:
- `core` - пакет с общими компонентами
- `map` - компоненты для работы с картой (объекты, здания, этажи)
- `navigation` - компоненты для работы с навигацией

Общие пакеты:
- `controller` - REST контроллеры
- `service` - сервисы
- `repository` - репозитории для работы с БД
- `model` - модели хранения данных в БД
- `schema` - классы схем для представления данных для клиента
- `enums` - перечисления Java
- `exception` - классы исключений
- `util` - различные утилитарные классы
- `config` - классы конфигураций

### Исключения
- `AppException` - базовый класс для исключений
- `NotFoundException` - сущность не была найдена
- `InvalidFormatException` - неверный формат входных данных

### Репозитории

#### MapBuildingRepository
Список доступных методов:
- `findById` - поиск объекта здания на карте по его идентификатору 

  Аргументы:
  * `Integer id` - идентификатор здания

  Возвращаемое значение: `Optional<MapBuilding>`

---

#### MapDomainRepository
Список доступных методов:
- `findById` - поиск объекта пространства на карте по его идентификатору 

  Аргументы:
  * `Integer id` - идентификатор пространства

  Возвращаемое значение: `Optional<MapDomain>`

- `findByBuildingId` - поиск объектов по идентификатору здания, к которому они принадлежат

  Аргументы:
  * `Integer id` - идентификатор здания
  
  Возвращаемое значение: `List<MapDomain>`

---

#### MapObjectRepository
Список доступных методов:
- `findById` - поиск объекта на карте по его идентификатору 

  Аргументы:
  * `Integer id` - идентификатор объекта

  Возвращаемое значение: `Optional<MapObject>`
  
- `findByDomainId` - поиска объекта по идентификатору пространства
  
  Аргументы:
  * `Integer id` - идентификатор пространства

  Возвращаемое значение: `List<MapObject>`

---

#### NodeRepository
Список доступных методов:
- `findById` - поиск узла графа по его идентификатору 

  Аргументы:
  * `Integer id` - идентификатор узла

  Возвращаемое значение: `Optional<NavNode>`

- `findByBuildingId` - поиск всех узлов, принадлежащих одному зданию, по его идентификатору
  
  Аргументы:
  * `Integer id` - идентификатор здания

  Возвращаемое значение: `List<NavNode>`

- `findConnections` - метод поиска всех соединений между данными узлами
  
  Аргументы:
  * `List<NavNode> nodes` - список узлов

  Возвращаемое значение: `List<NodesConnection>`

### Сервисы

#### MapService
Сервис для работы с объектами карты.

Список доступных методов:
- `getMapBuildingById` - получения объекта здания на карте

  Аргументы:
  * `Integer id` - идентификатор здания

  Возвращаемое значение: `MapBuildingSchema` или `null`, если объект не найден.

- `getMapDomainById` - получения объекта пространства на карте

  Аргументы:
  * `Integer id` - идентификатор пространства

  Возвращаемое значение: `MapDomainSchema` или `null`, если объект не найден.

---

#### NavigationService
Сервис для работы с навигацией

Список доступных методов:
- `findPath` - метод поиска пути по заданным точкам начала и конца

  Аргументы:
  * `NavPointSchema startPoint` - точка начала пути
  * `NavPointSchema endPoint` - точка конца пути
  
  Возвращаемое значение: `List<NavPointSchema>` - список точек, расположенных последовательно найденному пути.
  
  Исключения: `NotFoundException` - одна из точек находится в несуществующем пространстве

---

#### GraphService
Сервис для работы с навигационным графом

Список доступных методов:
- `getGraphByBuildingId` - метод для получения целого графа, принадлежащего одному зданию.
  Внутри использует собственный метод `buildGraph` для его построения, а затем кэширует результат.
  
  Аргументы:
  * `Integer buildingId` - идентификатор здания
  
  Возвращаемое значение: `Graph`
  
  Исключения:
  * `NotFoundException` - здания с `buildingId` не существует
  
- `buildGraph` - метод для построения графа по заданным узлам

  Аргументы:
  * `List<NavNode> nodes` - список узлов
  
  Возвращаемое значение: `Graph`
  
  Исключения:
  * `InvalidFormatException` - список `nodes` равен `null` или пустой.

### Контроллеры

#### MapController
Список доступных методов:
- `getMapBuildingById`
  
  Аргументы:
  * `Integer id`

  Возвращаемое значение: `MapBuildingSchema`
  
  Исключения:
  * `NotFoundException` - здания с `id` не существует

- `getMapDomainById`

  Аргументы:
  * `Integer id`

  Возвращаемое значение: `MapDomainSchema`
  
  Исключения:
  * `NotFoundException` - пространства с `id` не существует

---

#### NavigationController
Список доступных методов:
- `findPath`
  
  Аргументы:
  * `NavigationSchema schema` - схема, содержащая точки начала и конца
  
  Возвращаемое значение: `List<NavPointSchema>`
  
  Исключения:
  * `NotFoundException` - не удалось составить путь

### Другое

#### Vector2
Объект для представления двухмерного вектора.

Список доступных полей (данные поля доступны через соответствующие методы геттеров и сеттеров):
- `float x`
- `float y`

---

#### Graph
Объект для представления графа. Используется для построения графа одного здания

Список доступных методов:
- `searchClosestNode` - метод поиска ближайщего узла к заданной точке

  Аргументы:
  * `Integer domainId` - идентификатор пространства
  * `Vector2 position` - позиция данной точки
  
  Возвращаемое значение: `NavNode` - объект искомого узла
  
  Исключения:
  * `NotFoundException` - если `domainId` не соответствует текущему графу

- `getNodesDistance` - метод поиска расстояния между узлами

  Аргументы:
  * `NavNode node1`
  * `NavNode node2`
  
  Возвращаемое значение: `Double`
  
  Исключения:
  * `NotFoundException` - один из узлов не принадлежит данному графу

- `findPath` - метод поиска пути между двумя узлами

  Аргументы:
  * `NavNode startNode` - узел начала пути
  * `NavNode endNode` - узел конца пути
  
  Возвращаемое значение: `List<NavNode>` - список узлов, соответствующих пути. Список в начале и конце содержит начальный и конечный узлы соответственно.
  
  Исключения:
  * `NotFoundException` - один из узлов не принадлежит графу, либо между ними не существует пути.
